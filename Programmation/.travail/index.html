<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 2</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var config = {
        type: Phaser.AUTO,
        width: 1280,
        height: 720,
        input: {
            gamepad: true
        },
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 90 },//105
                debug: true
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

var player;
var cursors;
var recif;
var recif_block;
var grotte;
var algues;
var emitter;
var emitter2;
var particles;
var particles2;
var particles_bidon;
var emitter_bidon;
var particles_bidon2;
var emitter_bidon2;
var ennemi_bouteille;
var waste_monster;
var pad;
var reparation1 = true;
var reparation2 = true;
var reparation3 = true;
var playerPdv = 3;
var playerInvincible = false;
var timerInvulne;


var KeyZ;
var KeyQ;
var KeyS;
var keyD;

var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.image('background', 'assets/background.png');
        this.load.image('light', 'assets/lumiere_principale.png');
        this.load.image('light_grotte', 'assets/filtre_caverne.png');
        this.load.image('plan_01', 'assets/Recif_03.png');
        this.load.image('recif_block', 'assets/Recif_block.png');
        this.load.image('petit_recif','assets/assets_grotte/Entree_grotte-assets/petit_recif.png')
        //this.load.image('plan_01_Flip', 'assets/Algue_01_Flip.png');
        this.load.image('plan_02', 'assets/Recif_02.png');
        this.load.image('plan_02_Flip', 'assets/Recif_02_Flip.png');
        this.load.image('plan_03', 'assets/Recif_01.png');
        this.load.image('plan_03_Flip', 'assets/Recif_01_Flip.png');
        this.load.image('station', 'assets/background_station.png');
        this.load.spritesheet('sous-marin', 'assets/spriteSheet_sous_marin.png', { frameWidth: 183.5, frameHeight: 178 });
        this.load.spritesheet('sous-marin_bras', 'assets/spriteSheet.png', { frameWidth: 367.392857, frameHeight: 178 });
        this.load.spritesheet('algues','assets/sprite_algue.png', {frameWidth: 2553.25, frameHeight: 295 });
        this.load.spritesheet('waste_monster','assets/waste_monster/waste_monster-assets/spriteSheet_waste_monster.png',{frameWidth: 613.75, frameHeight: 391});
        this.load.image('particule_bulle','assets/particule_bulle.png');
        this.load.image('particules2', 'assets/particule_bulle.png');
        this.load.spritesheet('ennemi_bouteille','assets/SpriteSheet_ennemi_bouteille.png', {frameWidth: 101, frameHeight: 53});

        this.load.image('reparation','assets/Cle.png');
        this.load.image('HUD','assets/HUD_sous_marin.png');

        this.load.image('tuyaux','assets/Tuyaux.png');
        this.load.image('bidons','assets/bidons.png');

        this.load.image('particules_bidon', 'assets/particules_bidon.png');

        this.load.image('haut_grotte','assets/assets_grotte/Entree_grotte-assets/haut_grotte.png');
        this.load.image('haut_grotte_flip','assets/assets_grotte/Entree_grotte-assets/haut_grotte_flip.png');
        this.load.image('bas_grotte_01','assets/assets_grotte/Entree_grotte-assets/bas_grotte_01.png');
        this.load.image('bas_grotte_02','assets/assets_grotte/Entree_grotte-assets/bas_grotte_02.png');
        this.load.image('entree_grotte','assets/assets_grotte/Entree_grotte-assets/entree_grotte.png');
        this.load.image('fond_grotte','assets/assets_grotte/Entree_grotte-assets/fond_grotte_roche.png');
        this.load.image('block_central','assets/assets_grotte/Entree_grotte-assets/block_central_grotte.png');
        this.load.image('pilier_01','assets/assets_grotte/Entree_grotte-assets/pilier_grotte_01.png');
        this.load.image('pilier_02','assets/assets_grotte/Entree_grotte-assets/pilier_grotte_02.png');
        this.load.image('pilier_03','assets/assets_grotte/Entree_grotte-assets/pilier_grotte_03.png');

        

    }
    

    function create ()
    {

    this.add.image(0,0,'background').setOrigin(0).setScrollFactor(0);
    this.add.image(0,125, 'plan_03').setOrigin(0).setScrollFactor(0.25);
    this.add.image(1280,125, 'plan_03_Flip').setOrigin(0).setScrollFactor(0.25);
    this.add.image(2560, 125, 'plan_03').setOrigin(0).setScrollFactor(0.25);
    this.add.image(0,220, 'plan_02').setOrigin(0).setScrollFactor(0.4);
    this.add.image(1280,220, 'plan_02_Flip').setOrigin(0).setScrollFactor(0.4);
    this.add.image(2560,220, 'plan_02').setOrigin(0).setScrollFactor(0.4);
    this.add.image(3840,-80, 'station').setOrigin(0).setScrollFactor(0.4);


    particles_bidon = this.add.particles('particules_bidon');
    var emitter_bidon = particles_bidon.createEmitter({
        x: 2100,
        y: 720,
        speed: 100,
        frequency: 150,
        lifespan: 40000,
        blendMode:'ADD',
    });

    particles_bidon2 = this.add.particles('particules_bidon');
    var emitter_bidon2 = particles_bidon2.createEmitter({
        x: 3500,
        y: 720,
        speed: 100,
        frequency: 100,
        speed: 100,
        frequency: 150,
        lifespan: 40000,
        blendMode:'ADD',
    });

    this.add.image( 5950,350, 'bidons').setOrigin(0).setScrollFactor(0.4);
    
    this.add.image( 6000,0, 'tuyaux').setOrigin(0).setScrollFactor(0.4);

   
    

    timerInvulne = this.time.addEvent({
         delay: 2000
    });

    this.add.image( 17200,1500, 'fond_grotte').setOrigin(0).setScrollFactor(1);
    this.add.image( 17200,620, 'fond_grotte').setOrigin(0).setScrollFactor(1);
    this.add.image( 17200,0, 'fond_grotte').setOrigin(0).setScrollFactor(1);
    this.add.image( 16200,1500, 'fond_grotte').setOrigin(0).setScrollFactor(1);
    this.add.image( 16200,620, 'fond_grotte').setOrigin(0).setScrollFactor(1);
    this.add.image( 16200,0, 'fond_grotte').setOrigin(0).setScrollFactor(1);
    this.add.image( 15200,1500, 'fond_grotte').setOrigin(0).setScrollFactor(1);
    this.add.image( 15200,620, 'fond_grotte').setOrigin(0).setScrollFactor(1);
    this.add.image( 15200,0, 'fond_grotte').setOrigin(0).setScrollFactor(1);
    
    
    
    
    
    
    
    
    

    // Ajout particules bulle //

    particles = this.add.particles('particule_bulle');
    emitter = particles.createEmitter({
        x:170,
        y:10,
        speed: 50,
        scale: { start: 0.2, end: 0.5 },
        blendMode: 'ADD',
        
    });


    particles2 = this.add.particles('particules2');
    emitter2 = particles2.createEmitter({
        x:-170,
        y:10,
        speed: 50,
        scale: { start: 0.2, end: 0.5 },
        blendMode: 'ADD',
    });


   
    
    


    // joueur //
    player = this.physics.add.sprite(17000, 400, 'sous-marin');//depart 100, 200//
    player.setDamping(false);
    player.setDrag(80);
    player.setMaxVelocity(280);
    player.setSize(180, 178);
    player.setOffset(0,0);
    player.setCollideWorldBounds(true);


    waste_monster = this.physics.add.sprite(500, 500, 'waste_monster');
    waste_monster.body.setAllowGravity(false); // desactivation de la gravité pour les ennemis //
    waste_monster.setCollideWorldBounds(true);
    
    this.add.image(15100,50,'entree_grotte').setOrigin(0).setScrollFactor(1);
    this.add.image(16355,60,'pilier_01').setOrigin(0).setScrollFactor(1);
    //this.add.image(17000,600,'pilier_02').setOrigin(0).setScrollFactor(1);
    
    
    ennemi_bouteille = this.physics.add.sprite(3000,100, 'ennemi_bouteille');
    ennemi_bouteille.setSize(70,50);
    ennemi_bouteille.body.setAllowGravity(false); // desactivation de la gravité pour les ennemis //
    ennemi_bouteille.setCollideWorldBounds(true);
    
    this.tweens.add({
        targets: ennemi_bouteille,
        //x: 2500,
        y: 400,
        duration: 2000,
        yoyo: true,
        delay: 100,
        repeat: -1
    });


    
    

    recif = this.physics.add.staticGroup();
    //recif.create(400, 568, 'plan_01').setScale(2).refreshBody();//
    
    recif.create(0,560, 'plan_01').setOrigin(0).setScrollFactor(1).setOffset(0,210);
    recif.create(5115,560, 'plan_01').setOrigin(0).setScrollFactor(1).setOffset(0,210);
    recif.create(9671,560, 'plan_01').setOrigin(0).setScrollFactor(1).setOffset(0,210);
    recif.create(14687,580,'petit_recif').setOrigin(0).setScrollFactor(1).setSize(3100,200).setOffset(-2100,260);
    //recif.create(14227,560, 'plan_01').setOrigin(0).setScrollFactor(1);//

    recif_block = this.physics.add.staticGroup();
    recif_block.create(1280,1440, 'recif_block').setOrigin(1).setScrollFactor(1);
    recif_block.create(2560,1440, 'recif_block').setOrigin(1).setScrollFactor(1);
    recif_block.create(3840,1440, 'recif_block').setOrigin(1).setScrollFactor(1);
    recif_block.create(5120,1440, 'recif_block').setOrigin(1).setScrollFactor(1);
    recif_block.create(6400,1440, 'recif_block').setOrigin(1).setScrollFactor(1);
    recif_block.create(7680,1440, 'recif_block').setOrigin(1).setScrollFactor(1);
    recif_block.create(8960,1440, 'recif_block').setOrigin(1).setScrollFactor(1);
    recif_block.create(10240,1440, 'recif_block').setOrigin(1).setScrollFactor(1);
    recif_block.create(11520,1440, 'recif_block').setOrigin(1).setScrollFactor(1);
    recif_block.create(12800,1440, 'recif_block').setOrigin(1).setScrollFactor(1);
    recif_block.create(14080,1440, 'recif_block').setOrigin(1).setScrollFactor(1);
    recif_block.create(15360,1440, 'recif_block').setOrigin(1).setScrollFactor(1).setSize(2000,600).setOffset(0,0);
    recif_block.create(16640,1800, 'recif_block').setOrigin(1).setScrollFactor(1)
    recif_block.create(17920,1800, 'recif_block').setOrigin(1).setScrollFactor(1)
    recif_block.create(19200,2100, 'recif_block').setOrigin(1).setScrollFactor(1)
    recif_block.create(20480,2100, 'recif_block').setOrigin(1).setScrollFactor(1)

    
    



    grotte = this.physics.add.staticGroup();
    grotte.create(17285,87,'pilier_03').setOrigin(0).setScrollFactor(1).setSize(30,500).setOffset(240,300);
    grotte.create(15500,0,'haut_grotte').setOrigin(0).setScrollFactor(1).setSize(1000,1).setOffset(600,200);
    grotte.create(16637,0,'haut_grotte_flip').setOrigin(0).setScrollFactor(1).setSize(1000,1).setOffset(600,200);
    grotte.create(15351,678,'bas_grotte_01').setOrigin(0).setScrollFactor(1).setSize(30,350).setOffset(700,215);
    grotte.create(17911,970,'bas_grotte_01').setOrigin(0).setScrollFactor(1).setSize(30,350).setOffset(700,315);
    grotte.create(16631,895,'bas_grotte_02').setOrigin(0).setScrollFactor(1).setSize(1280,100).setOffset(700,283);
    grotte.create(19192,1191,'bas_grotte_02').setOrigin(0).setScrollFactor(1).setSize(2560,100).setOffset(-550,275);
    grotte.create(16210,500,'block_central').setOrigin(0).setScrollFactor(1).setSize(1080,30).setOffset(820,382);
    
    
            
    
    

    algues_2 = this.add.sprite(3790,610, 'algues');
    algues_3 = this.add.sprite(6350,610, 'algues');
    algues_4 = this.add.sprite(8910, 610, 'algues');
    algues_5 = this.add.sprite(11470, 610, 'algues');

    algues = this.add.sprite(1280,610, 'algues');
    this.add.image(0,0, 'light').setOrigin(0).setScrollFactor(0.23);
    this.add.image(1280,0, 'light').setOrigin(0).setScrollFactor(0.23);
    this.add.image(2560,0, 'light').setOrigin(0).setScrollFactor(0.23);
    this.add.image(3840,0, 'light_grotte').setOrigin(0).setScrollFactor(0.23);
    this.add.image(0,720, 'light_grotte').setOrigin(0).setScrollFactor(0.23);
    this.add.image(1280,720, 'light_grotte').setOrigin(0).setScrollFactor(0.23);
    this.add.image(2560,720, 'light_grotte').setOrigin(0).setScrollFactor(0.23);
    this.add.image(3840,720, 'light_grotte').setOrigin(0).setScrollFactor(0.23);


    this.add.image(10,10, 'HUD').setOrigin(0).setScrollFactor(0);

    // Point de vie du joueur sous forme de cle de reparation //

    reparation1 = this.physics.add.staticGroup();
    reparation2 = this.physics.add.staticGroup();
    reparation3 = this.physics.add.staticGroup();

    
    reparation1.create(125,60, 'reparation').setScrollFactor(0); 
    reparation2.create(155,60, 'reparation').setScrollFactor(0);
    reparation3.create(185,60, 'reparation').setScrollFactor(0);

    

    
  
    //  Ajout de la caméra //
    this.cameras.main.setBounds(0, 0, 1280 * 20, 1440);
    this.physics.world.setBounds(0, 0, 1280 * 20, 1440);
    this.cameras.main.startFollow(player, true, 0.05, 0.05);

    // controles ( pad & clavier)

    cursors = this.input.keyboard.createCursorKeys();
    keyZ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z);
    keyQ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q);
    keyS = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S);
    keyD = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);//ajouter clic souris//
                    


    this.input.gamepad.on('down', function (pad, button, index) {
        return;
    }),

    
    // animations // 

    this.anims.create({
        key: 'waste_monster',
        frames: this.anims.generateFrameNumbers('waste_monster', {start:0, end : 3}),
        frameRate : 7,
        repeat: -1
    })

    this.anims.create({
        key : 'ennemi_bouteille_01',
        frames: this.anims.generateFrameNumbers('ennemi_bouteille', {start:0, end : 3}),
        frameRate : 5,
        repeat: -1
    });

    this.anims.create({
        key : 'algues_1',
        frames: this.anims.generateFrameNumbers('algues', {start:0, end : 3}),
        frameRate : 1,
        repeat: -1
    });
    
    this.anims.create({
            key: 'left',
            frames: this.anims.generateFrameNumbers('sous-marin', { start: 0, end: 4 }),
            frameRate: 25,
            repeat: 1
        });

        this.anims.create({
            key: 'right',
            frames: this.anims.generateFrameNumbers('sous-marin', { start: 5, end: 9 }),
            frameRate: 25,
            repeat: 1
        });

        this.anims.create({
            key: 'bras_right',
            frames: this.anims.generateFrameNumbers('sous-marin_bras', { start: 10, end: 18 }),
            frameRate: 25,
            repeat: 0
        });

        this.anims.create({
            key: 'bras_left',
            frames: this.anims.generateFrameNumbers('sous-marin_bras', { start: 19, end: 27 }),
            frameRate: 25,
            repeat: 0
        });

    
        

    text = this.add.text(10, 120, '', { font: '16px Courier', fill: '#00ff00' });
    text.setScrollFactor(0);
    
    // collider & overlap //
    this.physics.add.collider(player, recif);
    this.physics.add.collider(player, grotte);
    this.physics.add.collider(player, recif_block);

    this.physics.add.overlap(player, ennemi_bouteille, kill, null, this);

    this.physics.add.collider(player, ennemi_bouteille,onHit, perd_vie, null, this);

    var collider = this.physics.add.collider(player, grotte, function (playerOnGrotte)
    {
        playerOnGrotte.body.stop();

        this.physics.world.removeCollider(collider);
    }, null, this);
}
        
    
        
    

    function update ()
    {
        

        text.setText('Speed: ' + player.body.speed);
        
        // Keyboard //

        if (keyQ.isDown)
        {
            //player.setVelocityX(-150);
            this.physics.velocityFromRotation(player.rotation, -300, player.body.acceleration);
            emitter.startFollow(player);
            emitter2.stopFollow(player);
            player.setSize(180, 178);
            player.setOffset(0,0);
            player.anims.play('left', true);
        }
        else{
            this.physics.velocityFromRotation(player.rotation,0, player.body.acceleration);
            emitter.stopFollow(player);
            emitter2.stopFollow(player);
        }
        if (keyD.isDown)
        {
            //player.setVelocityX(150);
            this.physics.velocityFromRotation(player.rotation, 300, player.body.acceleration);
            emitter.stopFollow(player);
            emitter2.startFollow(player);
            player.setSize(180, 178);
            player.setOffset(0,0);
            player.anims.play('right', true);   
        }
        else{
            this.physics.velocityFromRotation(player.rotation,0, player.body.acceleration);
            emitter.stopFollow(player);
            emitter2.stopFollow(player);

        }


        if (keyZ.isDown)
        {
            player.setVelocityY(-150);
            player.anims.play('right', true);
            
        }
        else if (keyS.isDown)
        {
            player.setVelocityY(150);
            player.anims.play('right', true);
            
        }
    
        if (this.input.gamepad.total === 0)
        {
            return;
        }

        // Gamepad //

        pad = this.input.gamepad.getPad(0);
        
        
        if (pad.axes.length)
        {
            var axisH = pad.axes[0].getValue();
            var axisV = pad.axes[1].getValue();
            //player.x += 2 * axisH;// modifier 2//
            //player.y += 1 * axisV;// modifier 1//
            player.flipX = (axisH >= -1);


           /* if (pad.X && axisH >= 0.1){
                player.anims.play('bras_right', true);
                player.setVelocityX(200);
                this.physics.velocityFromRotation(player.rotation, 300, player.body.acceleration);
                emitter2.startFollow(player);
                player.setSize(350, 178);
                player.setOffset(0,0);
                ennemi_bouteille.anims.play('ennemi_bouteille_01',true);
                
            }
            else if (axisH >= 0.1){
                
                player.anims.play('left',true);
                player.setVelocityX(200);
                waste_monster.anims.play('waste_monster',true);
                algues.anims.play('algues_1',true);
                algues_2.anims.play('algues_1',true);
                algues_3.anims.play('algues_1',true);
                algues_4.anims.play('algues_1',true);
                algues_5.anims.play('algues_1',true);
                this.physics.velocityFromRotation(player.rotation, 300, player.body.acceleration);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
                player.setSize(180, 178);
                player.setOffset(0,0);
            }
            
            if (pad.X && axisH <= -0.1){
                player.anims.play('bras_left', true);
                player.setVelocityX(-200);
                this.physics.velocityFromRotation(player.rotation, -300, player.body.acceleration);
                emitter.startFollow(player);
                emitter2.stopFollow(player);
                player.setSize(350, 178);
                player.setOffset(10,0);
            }

            else if (axisH <= -0.1){
                player.setOffset(185,0);
                player.setVelocityX(-200);
                player.anims.play('right', true);
                player.flipX = (axisH = -1);
                this.physics.velocityFromRotation(player.rotation, -300, player.body.acceleration);  
                emitter.startFollow(player);
                emitter2.stopFollow(player);       
            }

            if (pad.X && axisV >= 0.1){
                
                player.setVelocityY(100);
                //this.physics.velocityFromRotation(player.rotation, 300, player.body.acceleration);
                emitter2.startFollow(player);
                
                
            }
                
            
            else if (axisV >= 0.1){
                
                player.anims.play('left',true);
                player.setVelocityY(100);
                //this.physics.velocityFromRotation(player.rotation, 300, player.body.acceleration);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
                
            }

            if (pad.X && axisV <= -0.1){
                player.anims.play('bras_right', true);
                player.setVelocityY(-100);
                //this.physics.velocityFromRotation(player.rotation, -300, player.body.acceleration);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
                
            }
            
            else if (axisV <= -0.1){
                player.setVelocityY(-100);
                player.anims.play('left', true);
                //this.physics.velocityFromRotation(player.rotation, -300, player.body.acceleration);  
                emitter.stopFollow(player);
                emitter2.startFollow(player);
                   
            }

            if (pad.X && axisV >= 0.1 && axisH >= 0.1){
                player.setVelocityX(200);
                player.setVelocityY(10);
                player.anims.play('bras_right', true);
                this.physics.velocityFromRotation(player.rotation, 300, player.body.acceleration);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
            }
            else if (axisV >= 0.1 && axisH >= 0.1){
                player.anims.play('left', true);
                player.setVelocityX(200);
                player.setVelocityY(10);
                this.physics.velocityFromRotation(player.rotation, 300, player.body.acceleration);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
            }

            if (pad.X && axisV <= -0.1 && axisH <= -0.1){
                player.setVelocityX(-200);
                player.setVelocityY(-10);
                player.anims.play('bras_left', true);
                this.physics.velocityFromRotation(player.rotation, -300, player.body.acceleration);
                emitter.startFollow(player);
                emitter2.stopFollow(player);
            }
            else if (axisV <= -0.1 && axisH <= -0.1){
                player.anims.play('right', true);
                player.setVelocityX(-200);
                player.setVelocityY(-10);
                this.physics.velocityFromRotation(player.rotation, -300, player.body.acceleration);
                emitter.startFollow(player);
                emitter2.stopFollow(player);
            }

            if (pad.X && axisV >= 0.1 && axisH <= -0.1){//ok
                player.setVelocityX(-200);
                player.setVelocityY(10);
                player.anims.play('bras_left', true);
                this.physics.velocityFromRotation(player.rotation, -300, player.body.acceleration);
                emitter.startFollow(player);
                emitter2.stopFollow(player);
            }
            else if (axisV >= 0.1 && axisH <= -0.1){//ok
                player.anims.play('right', true);
                player.setVelocityX(-200);
                player.setVelocityY(10);
                this.physics.velocityFromRotation(player.rotation, -300, player.body.acceleration);
                emitter.startFollow(player);
                emitter2.stopFollow(player);
            }
            if (pad.X && axisV <= -0.1 && axisH >= 0.1){//ok
                player.anims.play('bras_right', true);
                player.setVelocityX(200);
                player.setVelocityY(-10);
                this.physics.velocityFromRotation(player.rotation, 300, player.body.acceleration);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
            }
            else if (axisV <= -0.1 && axisH >= 0.1){//ok
                player.anims.play('left', true);
                player.setVelocityX(200);
                player.setVelocityY(-10);
                this.physics.velocityFromRotation(player.rotation, 300, player.body.acceleration);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
            }*/

            if (pad.X && axisH >= 0.1){
                player.setAccelerationX(300);
                emitter2.startFollow(player);
                player.setSize(350, 178);
                player.setOffset(0,0);
                player.anims.play('bras_right', true);
            }
            else if(axisH >= 0.1){
                player.anims.play('left', true);
                player.setAccelerationX(300);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
                player.setSize(180, 178);
                player.setOffset(0,0);
            }


            if (pad.X && axisH <= -0.1){
                player.setAccelerationX(-300);
                emitter.startFollow(player);
                player.setSize(350, 178);
                player.setOffset(0,0);
                player.anims.play('bras_left', true);
            }

            else if(axisH <= -0.1){
                player.setAccelerationX(-300);
                player.anims.play('right', true);
                emitter.startFollow(player);
                emitter2.stopFollow(player);
                player.setSize(180, 178);
                player.setOffset(185,0);
                
            }

            if(axisV >= 0.8 && axisH == 0){
                player.setAccelerationY(200);
                player.setSize(180, 178);
                player.setOffset(0,0);
                if (player.anims.play('right')){
                    player.setOffset(185,0);
                }
                if (player.anims.play('left')){
                    player.setOffset(0,0);
                }
                if (emitter == true){
                    emitter.startFollow(player);
                    emitter2.stopFollow(player);
                }
                else if (emitter2 == true){
                    emitter.stopFollow(player);
                    emitter2.startFollow(player);
                }
                
            }
            if(axisV <= -0.8 && axisH ==0){
                player.setAccelerationY(-200);
                player.setSize(180, 178);
                player.setOffset(185,0);
                if (player.anims.play('right')){
                    player.setOffset(185,0);
                }
                if (player.anims.play('left')){
                    player.setOffset(0,0);
                }
                if (emitter2 == true){
                    emitter.stopFollow(player);
                    emitter2.startFollow(player);
                }
                else if (emitter == true){
                    emitter.startFollow(player);
                    emitter2.stopFollow(player);
                }
            }


            if (pad.X && axisH >= 0.1 && axisV <=-0.3){
                player.setAccelerationX(300);
                player.setAccelerationY(-150);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
                player.setSize(350, 178);
                player.setOffset(0,0);
                player.anims.play('bras_right', true);
            }
            else if (axisH >= 0.1 && axisV <=-0.3){
                player.setAccelerationX(300);
                player.setAccelerationY(-150);
                player.anims.play('left', true);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
                player.setSize(180, 178);
                player.setOffset(0,0);
                
            }

            if (pad.X && axisH >= 0.1 && axisV >= 0.3){
                player.setAccelerationX(300);
                player.setAccelerationY(150);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
                player.setSize(350, 178);
                player.setOffset(0,0);
                player.anims.play('bras_right', true);
            }
            else if (axisH >= 0.1 && axisV >= 0.3){
                player.setAccelerationX(300);
                player.setAccelerationY(150);
                player.anims.play('left', true);
                emitter.stopFollow(player);
                emitter2.startFollow(player);
                player.setSize(180, 178);
                player.setOffset(0,0);
            }
            if (pad.X && axisH <= -0.1 && axisV <=-0.3){
                player.setAccelerationX(-300);
                player.setAccelerationY(-150);
                emitter.startFollow(player);
                emitter2.stopFollow(player)
                player.setSize(350, 178);
                player.setOffset(10,0);
                player.anims.play('bras_left', true);
            }

            else if (axisH <= -0.1 && axisV <=-0.3){
                player.setAccelerationX(-300);
                player.setAccelerationY(-150);
                player.anims.play('right', true);
                emitter.startFollow(player);
                emitter2.stopFollow(player);
                player.setSize(180, 178);
                player.setOffset(185,0);
            }

            if (pad.X && axisH <= -0.1 && axisV >= 0.3){
                player.setAccelerationX(-300);
                player.setAccelerationY(150);
                emitter.startFollow(player);
                emitter2.stopFollow(player);
                player.setSize(350, 178);
                player.setOffset(10,0);
                player.anims.play('bras_left', true);
            }
            else if (axisH <= -0.1 && axisV >= 0.3){
                player.setAccelerationX(-300);
                player.setAccelerationY(150);
                player.anims.play('right', true);
                emitter.startFollow(player);
                emitter2.stopFollow(player);
                player.setSize(180, 178);
                player.setOffset(185,0);
            }

            if (axisV == 0 && axisH == 0 ){
                player.setAcceleration(0);
                emitter.stopFollow(player);
                emitter2.stopFollow(player); 
            }
        }
    }
    
    
    function kill (player, ennemi_bouteille) 
        {
            if (pad.X){
                ennemi_bouteille.destroy(true, true);
            }
        }

    function perd_vie (player, ennemi_bouteille){

        playerPdv --;
        if (playerPdv == 2){
            reparation3.destroy(true,true);
            // animation d'invulnérabilité //
        }
        if (playerPdv == 1){
            reparation2.destroy(true,true);
            // animation d'invulnérabilité //
        }
        if (playerPdv == 0){
            reparation1.destroy(true,true);
            // animation d'invulnérabilité //
        }

    }

    function onHit(playerPdv) {
    if (!playerInvincible) { //We only damage the player if not invincible
      playerPdv --;

      //We now need to make the player invincible
      playerInvincible = true;
      
      //and then we add a timer to restore the player to a vulnerable state
      timerInvulne(function() {
           playerInvincible = false;
      }), this; 
    }
}
</script>

</body>
</html>